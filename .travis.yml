language: node_js

node_js:
  - "node"
  - "lts/*"

stages:
  - lint
  - test
  - compile
  - name: deploy
    if: branch = master

install:
  - npm ci
  - npm run config:peers

jobs:
  include:
    - stage: lint
      name: tslint
      script: npm run lint
    - stage: test
      name: jest-unit-test
      script: npm run test -- --coverage && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js
    - stage: compile
      name: transpile-typescript-node
      script: npm run compile
      name: transpile-typescript-browser
      script: npm run compile:browser